{"version":3,"file":"index.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;;;;;;;;;;;;;;ACViD;;AAEjD;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,IAAI,kEAAwB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,IAAI,kEAAwB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,IAAI,kEAAwB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,IAAI,kEAAwB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,IAAI,kEAAwB;AAC5B;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,IAAI,kEAAwB;AAC5B;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,IAAI,kEAAwB;AAC5B;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,IAAI,kEAAwB;AAC5B;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;AAEA,iEAAe,cAAc;;;;;;;;;;;;;;AC5I7B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,wBAAwB,gBAAgB,cAAc,sBAAsB,gBAAgB,+BAA+B,iBAAiB,gCAAgC;;AAE5K;AACA,0CAA0C,cAAc;AACxD;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA,iEAAe,eAAe;;;;;;UC5C9B;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;;ACNiD;AACD;;AAEhD;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,4CAA4C,cAAc;AAC1D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,uEAA6B;AACrC,MAAM;AACN;AACA;;AAEA;AACA;AACA,qBAAqB,IAAI;AACzB,sBAAsB,IAAI;AAC1B;AACA;AACA;AACA;AACA,QAAQ;AACR;;AAEA;AACA;AACA;AACA;AACA;AACA,wFAAwF;AACxF,qFAAqF;AACrF,wFAAwF;;AAExF;AACA;AACA,YAAY;;AAEZ;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA,QAAQ,oEAA0B;AAClC,MAAM;AACN;AACA;AACA;;AAEA;AACA,sBAAsB,WAAW;;AAEjC;AACA;AACA;AACA;AACA;;AAEA;AACA,sDAAsD;AACtD;AACA;AACA,MAAM;AACN;AACA;AACA,+CAA+C,SAAS,WAAW;AACnE;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,kDAAkD,iBAAiB;;AAEnE;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,QAAQ,wEAA6B;AACrC,MAAM;AACN;AACA;AACA;;AAEA;AACA;;AAEA,IAAI,0EAA+B;;AAEnC;AACA;;AAEA;AACA;AACA;;AAEA,iEAAe,iBAAiB,E","sources":["webpack://WebdelegateClient/webpack/universalModuleDefinition","webpack://WebdelegateClient/./src/ui-event-manager.js","webpack://WebdelegateClient/./src/websocket-client.js","webpack://WebdelegateClient/webpack/bootstrap","webpack://WebdelegateClient/webpack/runtime/define property getters","webpack://WebdelegateClient/webpack/runtime/hasOwnProperty shorthand","webpack://WebdelegateClient/webpack/runtime/make namespace object","webpack://WebdelegateClient/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebdelegateClient\"] = factory();\n\telse\n\t\troot[\"WebdelegateClient\"] = factory();\n})(self, function() {\nreturn ","import WebsocketClient from \"./websocket-client\";\n\nconst UIEventManager = {\n    activated: false,\n}\n\nUIEventManager.activate = function() {\n    if (UIEventManager.activated) {\n        throw 'UIEventManager already activated!';\n    }\n\n    UIEventManager.onWindowResize = UIEventManager.onWindowResize.bind(this);\n\n    window.addEventListener('resize', UIEventManager.onWindowResize);\n    this.output_canvas.addEventListener('mousemove', UIEventManager.onMouseMove);\n    this.output_canvas.addEventListener('mousedown', UIEventManager.onMouseDown);\n    this.output_canvas.addEventListener('mouseup', UIEventManager.onMouseUp);\n    this.output_canvas.addEventListener('mouseout', UIEventManager.onMouseUp);\n    this.output_canvas.addEventListener('wheel', UIEventManager.onMouseWheel);\n\n    window.addEventListener('keydown', UIEventManager.onKeyDown);\n    window.addEventListener('keyup', UIEventManager.onKeyUp);\n\n    this.output_canvas.addEventListener('contextmenu', UIEventManager.onContextMenu);\n\n    window.addEventListener('popstate', UIEventManager.onPopState);\n\n    UIEventManager.activated = true;\n}\n\nUIEventManager.deactivate = function() {\n    window.removeEventListener('resize', UIEventManager.onWindowResize);\n    this.output_canvas.removeEventListener('mousemove', UIEventManager.onMouseMove);\n    this.output_canvas.removeEventListener('mousedown', UIEventManager.onMouseDown);\n    this.output_canvas.removeEventListener('mouseup', UIEventManager.onMouseUp);\n    this.output_canvas.removeEventListener('wheel', UIEventManager.onMouseWheel);\n\n    window.removeEventListener('keydown', UIEventManager.onKeyDown);\n    window.removeEventListener('keyup', UIEventManager.onKeyUp);\n\n    this.output_canvas.removeEventListener('contextmenu', UIEventManager.onContextMenu);\n\n    window.removeEventListener('popstate', UIEventManager.onPopState);\n\n    UIEventManager.activated = false;\n}\n\nUIEventManager.onWindowResize = function(event) {\n    this.output_canvas.width = this.output_canvas.clientWidth;\n    this.output_canvas.height = this.output_canvas.clientHeight;\n\n    WebsocketClient.sendData({\n        category: 'event',\n        data: {\n            type: 'resize',\n            w: this.output_canvas.width,\n            h: this.output_canvas.height\n        }\n    });\n}\n\nUIEventManager.onMouseMove = function(event) {\n    WebsocketClient.sendData({\n        category: 'event',\n        data: {\n            type: 'mousemove',\n            x: event.clientX,\n            y: event.clientY\n        }\n    });\n}\n\nUIEventManager.onMouseDown = function(event) {\n    WebsocketClient.sendData({\n        category: 'event',\n        data: {\n            type: 'mousedown',\n            button: event.button,\n            x: event.clientX,\n            y: event.clientY\n        }\n    });\n}\n\nUIEventManager.onMouseUp = function(event) {\n    WebsocketClient.sendData({\n        category: 'event',\n        data: {\n            type: 'mouseup',\n            x: event.clientX,\n            y: event.clientY\n        }\n    });\n}\n\nUIEventManager.onMouseWheel = function(event) {\n    WebsocketClient.sendData({\n        category: 'event',\n        data: {\n            type: 'wheel',\n            delta: event.deltaY\n        }\n    });\n}\n\nUIEventManager.onKeyDown = function(event) {\n    // console.log(event.code);\n    WebsocketClient.sendData({\n        category: 'event',\n        data: {\n            type: 'keydown',\n            key: event.code\n        }\n    });\n}\n\nUIEventManager.onKeyUp = function(event) {\n    WebsocketClient.sendData({\n        category: 'event',\n        data: {\n            type: 'keyup',\n            key: event.code\n        }\n    });\n}\n\nUIEventManager.onPopState = function (event) {\n    event.preventDefault();\n    history.pushState(null, document.title, location.href);\n    WebsocketClient.sendData({\n        category: 'command',\n        data: {\n            type: 'history',\n            value: 'back'\n        }\n    });\n}\n\nUIEventManager.onContextMenu = (event) => event.preventDefault();\n\nexport default UIEventManager;","const WebsocketClient = {\n    protocol: 'vedulabs-ssr',\n    ws: null,\n}\n\nWebsocketClient.connect = function(\n    everyNthFrame,\n) {\n    if (WebsocketClient.ws) {\n        throw 'WebsocketClient already connected';\n    }\n\n    let connectURL = `${this.server_url}?target_url=${btoa(this.target_url)}&target_width=${this.output_canvas.clientWidth}&target_height=${this.output_canvas.clientHeight}`;\n\n    if (everyNthFrame) {\n        connectURL += `&every_nth_frame=${everyNthFrame}`;\n    }\n\n    WebsocketClient.ws = new WebSocket(connectURL, this.protocol);\n\n    WebsocketClient.ws.onopen = event => this.onConnected.apply(this, [event]);\n    WebsocketClient.ws.onmessage = event => this.onDataRecevied.apply(this, [event]);\n    WebsocketClient.ws.onclose = event => this.onDisconnected.apply(this, [event]);\n    WebsocketClient.ws.onerror = event => this.onError.apply(this, [event]);\n}\n\nWebsocketClient.disconnect = function() {\n    if (WebsocketClient.ws) {\n        WebsocketClient.ws.close();\n\n        WebsocketClient.ws = null;\n    } else {\n        throw 'WebdelegateClient is not connected'\n    }\n}\n\nWebsocketClient.sendData = function(data) {\n    if (WebsocketClient.ws) {\n        WebsocketClient.ws.send(JSON.stringify(data));\n    } else {\n        throw 'WebdelegateClient is disconnected'\n    }\n}\n\nexport default WebsocketClient;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import WebsocketClient from './websocket-client';\nimport UIEventManager from './ui-event-manager';\n\nconst outputImage = new Image();\n\nconst capturedOutMedia = document.createElement('video');\nconst mediaSource = new MediaSource();\n\nconst WebdelegateClient = {\n    server_url: null,\n    target_url: null,\n    output_canvas: null,\n\n    error: (error_message) => {\n        console.error(`WebdelegateClient: ${error_message}`)\n    }\n}\n\nWebdelegateClient.start = function({\n    server_url,\n    target_url,\n    output_canvas,\n    everyNthFrame,\n} = {}) {\n    if (!server_url) {\n        this.error('Server URL is not defined!');\n        return;\n    }\n    if (!target_url) {\n        this.error('Target URL is not defined!');\n        return;\n    }\n    if (!output_canvas) {\n        this.error('Output canvas DOM element is not defined!');\n        return;\n    }\n\n    this.server_url = server_url;\n    this.target_url = target_url;\n    this.output_canvas = output_canvas;\n    this.output_canvas_ctx = this.output_canvas.getContext('2d');\n\n    try {\n        WebsocketClient.connect.apply(this, [everyNthFrame]);\n    } catch (ex) {\n        this.error(ex);\n    }\n\n    // capturedOutMedia.autoplay = true;\n    // Object.assign(capturedOutMedia.style, {\n    //     width: `${500}px`,\n    //     height: `${500}px`,\n    //     backgroundColor: 'yellow',\n    //     position: 'absolute',\n    //     top: 0,\n    //     left: 0,\n    // });\n    // document.body.appendChild(capturedOutMedia);\n\n    capturedOutMedia.src = URL.createObjectURL(mediaSource);\n    capturedOutMedia.setAttribute('autoplay', true);\n    // capturedOutMedia.setAttribute('preload', 'auto');\n    mediaSource.addEventListener('sourceopen', () => {\n        URL.revokeObjectURL(capturedOutMedia.src);\n        // this.capturedOutMediaSourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs=\"vp8\", opus');\n        this.capturedOutMediaSourceBuffer = mediaSource.addSourceBuffer('audio/webm; codecs=opus');\n        // this.capturedOutMediaSourceBuffer = mediaSource.addSourceBuffer('audio/opus; codecs=\"opus\"');\n\n        // this.capturedOutMediaSourceBuffer.addEventListener('updateend', function (_) {\n        //     console.log('updateend')\n        // });\n\n        this.capturedOutMediaSourceBuffer.mode = 'sequence';\n    });\n\n    // console.log(this);\n}\n\nWebdelegateClient.stop = function() {\n    try {\n        WebsocketClient.disconnect();\n    } catch (ex) {\n        this.error(ex);\n    }\n}\n\nWebdelegateClient.onDataRecevied = async function(event) {\n    // console.log(`${Date.now()}: DATA RECEVIED`);\n\n    if (event.data.arrayBuffer) {\n        const buffer = await event.data.arrayBuffer();\n    \n        if(!this.capturedOutMediaSourceBuffer.updating) {\n            this.capturedOutMediaSourceBuffer.appendBuffer(buffer);\n\n            if (capturedOutMedia.paused) {\n                capturedOutMedia.play(0).catch(e => {});\n            }\n        }\n    } else {\n        const data = JSON.parse(event.data);\n        if (data.frame) {\n            outputImage.src = `data:image/jpeg;base64,${data.frame}`;\n            return;\n        }\n        if (data.cursor) {\n            this.output_canvas.style.cursor = data.cursor;\n        }\n    }\n\n\n    // mediaQueue.push(event.data);\n    // const reader = new FileReader();\n    // reader.onload = (e) => { \n    //     this.capturedOutMediaSourceBuffer.appendBuffer(new Uint8Array(e.target.result));\n\n    //     reader.onload = null;\n    // }\n    // reader.readAsArrayBuffer(mediaQueue.shift());\n}\n\nWebdelegateClient.onConnected = function(event) {\n    console.log(`WebdelegateClient connected to ${event.target.url}`);\n\n    outputImage.onload = () => {\n        this.output_canvas.width = this.output_canvas.clientWidth;\n        this.output_canvas.height = this.output_canvas.clientHeight;\n        this.output_canvas_ctx.clearRect(0, 0, this.output_canvas.width, this.output_canvas.height);\n        this.output_canvas_ctx.drawImage(outputImage, 0, 0);\n    };\n    outputImage.onload.bind(this);\n\n    try {\n        UIEventManager.activate.apply(this);\n    } catch (ex) {\n        this.error(ex);\n    }\n}\n\nWebdelegateClient.onDisconnected = function(event) {\n    this.output_canvas_ctx.clearRect(0, 0, this.output_canvas.width, this.output_canvas.height);\n\n    UIEventManager.deactivate.apply(this);\n\n    console.info('WebdelegateClient is DISCONNECTED');\n}\n\nWebdelegateClient.onError = function(event) {\n    console.warn('WebdelegateClient has encoutered a connection error');\n}\n\nexport default WebdelegateClient;"],"names":[],"sourceRoot":""}